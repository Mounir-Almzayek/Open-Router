# Tool/Function Calling

## Feature Overview

Tool calling (also known as function calling) enables AI models to interact with external systems, APIs, and functions. Instead of just generating text, models can request specific function executions, pass parameters, and receive results—enabling AI to perform actions, retrieve data, and integrate with external services.

*استدعاء الأدوات (المعروف أيضاً باسم استدعاء الدوال) يتيح لنماذج الذكاء الاصطناعي التفاعل مع الأنظمة الخارجية وAPIs والدوال. بدلاً من توليد النص فقط، يمكن للنماذج طلب تنفيذ دوال محددة وتمرير المعاملات واستقبال النتائج—مما يتيح للذكاء الاصطناعي تنفيذ الإجراءات واسترجاع البيانات والتكامل مع الخدمات الخارجية.*

## Feature Importance

Tool calling transforms AI from a text generator into an actionable assistant that can interact with the real world. This capability enables applications like virtual assistants that can check weather, book appointments, search databases, and perform actions—making AI truly useful for real-world tasks.

*استدعاء الأدوات يحول الذكاء الاصطناعي من مولد نصوص إلى مساعد قابل للتنفيذ يمكنه التفاعل مع العالم الحقيقي. هذه القدرة تتيح تطبيقات مثل المساعدين الافتراضيين الذين يمكنهم التحقق من الطقس وحجز المواعيد والبحث في قواعد البيانات وتنفيذ الإجراءات—مما يجعل الذكاء الاصطناعي مفيداً حقاً للمهام الواقعية.*

## Key Benefits

### Real-World Integration
Tool calling enables AI to interact with external APIs, databases, services, and systems. This allows AI applications to perform real actions like sending emails, updating databases, or calling external services.

*استدعاء الأدوات يتيح للذكاء الاصطناعي التفاعل مع APIs الخارجية وقواعد البيانات والخدمات والأنظمة. هذا يسمح لتطبيقات الذكاء الاصطناعي بتنفيذ إجراءات حقيقية مثل إرسال البريد الإلكتروني أو تحديث قواعد البيانات أو استدعاء الخدمات الخارجية.*

### Dynamic Information Retrieval
Instead of relying solely on training data, AI can retrieve current information by calling tools. This enables applications that need up-to-date data like weather, stock prices, or news.

*بدلاً من الاعتماد فقط على بيانات التدريب، يمكن للذكاء الاصطناعي استرجاع المعلومات الحالية عن طريق استدعاء الأدوات. هذا يتيح التطبيقات التي تحتاج بيانات حديثة مثل الطقس أو أسعار الأسهم أو الأخبار.*

### Structured Data Processing
Tool calling enables structured data exchange between AI and external systems. Functions receive structured parameters and return structured results, enabling reliable integration with existing systems.

*استدعاء الأدوات يتيح تبادل البيانات المنظمة بين الذكاء الاصطناعي والأنظمة الخارجية. الدوال تستقبل معاملات منظمة وتعيد نتائج منظمة، مما يتيح التكامل الموثوق مع الأنظمة الموجودة.*

### Action Execution
AI can perform actions through tool calls—sending notifications, updating records, triggering workflows, and executing business logic. This transforms AI from a consultant to an executor.

*يمكن للذكاء الاصطناعي تنفيذ الإجراءات من خلال استدعاءات الأدوات—إرسال الإشعارات وتحديث السجلات وتشغيل سير العمل وتنفيذ منطق الأعمال. هذا يحول الذكاء الاصطناعي من مستشار إلى منفذ.*

### Extensibility
Tool calling makes AI systems extensible—you can add new capabilities by defining new tools without retraining models. This enables rapid feature development and customization.

*استدعاء الأدوات يجعل أنظمة الذكاء الاصطناعي قابلة للتوسع—يمكنك إضافة قدرات جديدة عن طريق تعريف أدوات جديدة دون إعادة تدريب النماذج. هذا يتيح تطوير الميزات والتخصيص السريع.*

## Use Cases

### Virtual Assistants
Create virtual assistants that can check weather, set reminders, send messages, and perform various tasks through tool calls. Users can interact naturally while the assistant executes actions behind the scenes.

*أنشئ مساعدين افتراضيين يمكنهم التحقق من الطقس وتعيين التذكيرات وإرسال الرسائل وتنفيذ مهام مختلفة من خلال استدعاءات الأدوات. يمكن للمستخدمين التفاعل بشكل طبيعي بينما ينفذ المساعد الإجراءات خلف الكواليس.*

### Database Query Systems
Enable AI to query databases, retrieve information, and perform data operations through tool calls. Users can ask natural language questions and get database results without writing SQL.

*مكن الذكاء الاصطناعي من الاستعلام عن قواعد البيانات واسترجاع المعلومات وتنفيذ عمليات البيانات من خلال استدعاءات الأدوات. يمكن للمستخدمين طرح أسئلة باللغة الطبيعية والحصول على نتائج قاعدة البيانات دون كتابة SQL.*

### API Integration
Integrate AI with external APIs to retrieve data, perform actions, and interact with third-party services. This enables AI applications that leverage existing services and infrastructure.

*ادمج الذكاء الاصطناعي مع APIs الخارجية لاسترجاع البيانات وتنفيذ الإجراءات والتفاعل مع خدمات الطرف الثالث. هذا يتيح تطبيقات الذكاء الاصطناعي التي تستفيد من الخدمات والبنية التحتية الموجودة.*

### Workflow Automation
Automate business workflows by enabling AI to trigger actions, update systems, and coordinate multiple services through tool calls. This enables intelligent automation of complex processes.

*أتمتة سير عمل الأعمال عن طريق تمكين الذكاء الاصطناعي من تشغيل الإجراءات وتحديث الأنظمة وتنسيق خدمات متعددة من خلال استدعاءات الأدوات. هذا يتيح أتمتة ذكية للعمليات المعقدة.*

### Data Processing Pipelines
Create AI-powered data processing pipelines where AI analyzes data and calls tools to transform, store, or process information. This enables intelligent data workflows.

*أنشئ خطوط معالجة بيانات مدعومة بالذكاء الاصطناعي حيث يحلل الذكاء الاصطناعي البيانات ويستدعي الأدوات لتحويل أو تخزين أو معالجة المعلومات. هذا يتيح سير عمل بيانات ذكي.*

## Performance Considerations

### Tool Call Overhead
Each tool call adds latency to the response. The model must generate the tool call, wait for execution, and process results. Minimize tool calls when possible and batch operations when appropriate.

*كل استدعاء أداة يضيف زمن انتظار للاستجابة. يجب على النموذج توليد استدعاء الأداة وانتظار التنفيذ ومعالجة النتائج. قلل استدعاءات الأدوات عند الإمكان واجمع العمليات عند الاقتضاء.*

### Sequential vs Parallel Execution
Tool calls are typically executed sequentially, which can slow down responses with multiple tool calls. Some systems support parallel execution—use it when possible to reduce latency.

*استدعاءات الأدوات عادة ما تنفذ بشكل تسلسلي، مما يمكن أن يبطئ الاستجابات مع استدعاءات أدوات متعددة. بعض الأنظمة تدعم التنفيذ المتوازي—استخدمه عند الإمكان لتقليل زمن الانتظار.*

### Error Handling
Tool calls can fail due to network issues, API errors, or invalid parameters. Implement robust error handling to gracefully manage failures and provide useful feedback to users.

*استدعاءات الأدوات يمكن أن تفشل بسبب مشاكل الشبكة أو أخطاء API أو معاملات غير صالحة. نفذ معالجة أخطاء قوية للتعامل مع الفشل بشكل سلس وتوفير ردود فعل مفيدة للمستخدمين.*

### Token Consumption
Tool definitions consume tokens in the request, and tool call results consume tokens in the response. Keep tool definitions concise and limit result sizes to manage token costs.

*تعريفات الأدوات تستهلك الرموز المميزة في الطلب، ونتائج استدعاءات الأدوات تستهلك الرموز المميزة في الاستجابة. حافظ على تعريفات الأدوات موجزة وحدد أحجام النتائج لإدارة تكاليف الرموز المميزة.*

## Cost Implications

### Token Costs
Tool definitions add tokens to requests, and tool call results add tokens to responses. More tools and larger results increase costs. Keep tool definitions concise and limit result sizes.

*تعريفات الأدوات تضيف رموزاً مميزة للطلبات، ونتائج استدعاءات الأدوات تضيف رموزاً مميزة للاستجابات. المزيد من الأدوات والنتائج الأكبر تزيد التكاليف. حافظ على تعريفات الأدوات موجزة وحدد أحجام النتائج.*

### API Call Costs
Tool calls may trigger external API calls that have their own costs. Consider the costs of external services when designing tools. Cache results when appropriate to reduce API calls.

*استدعاءات الأدوات قد تشغل استدعاءات API خارجية لها تكاليفها الخاصة. ضع في الاعتبار تكاليف الخدمات الخارجية عند تصميم الأدوات. قم بتخزين النتائج مؤقتاً عند الاقتضاء لتقليل استدعاءات API.*

### Multiple Tool Calls
Responses with multiple tool calls consume more tokens and take longer. Optimize tool usage to minimize the number of calls while achieving desired functionality.

*الاستجابات مع استدعاءات أدوات متعددة تستهلك المزيد من الرموز المميزة وتستغرق وقتاً أطول. قم بتحسين استخدام الأدوات لتقليل عدد الاستدعاءات مع تحقيق الوظيفة المطلوبة.*

## Best Practices

### Tool Design
Design tools with clear, specific purposes. Use descriptive names and detailed descriptions to help the model understand when and how to use each tool. Keep tool schemas simple and well-defined.

*صمم الأدوات بأغراض واضحة ومحددة. استخدم أسماء وصفية وأوصاف مفصلة لمساعدة النموذج على فهم متى وكيفية استخدام كل أداة. حافظ على مخططات الأدوات بسيطة ومحددة جيداً.*

### Parameter Validation
Validate tool parameters before execution to prevent errors and ensure security. Implement input validation, type checking, and sanitization to protect against invalid or malicious inputs.

*تحقق من معاملات الأداة قبل التنفيذ لمنع الأخطاء وضمان الأمان. نفذ التحقق من المدخلات والتحقق من النوع والتعقيم للحماية من المدخلات غير الصالحة أو الخبيثة.*

### Error Handling
Implement comprehensive error handling for tool calls. Provide meaningful error messages, handle timeouts gracefully, and implement retry logic for transient failures.

*نفذ معالجة أخطاء شاملة لاستدعاءات الأدوات. وفر رسائل خطأ ذات معنى وتعامل مع انتهاء المهلة بشكل سلس ونفذ منطق إعادة المحاولة للفشل المؤقت.*

### Tool Choice Configuration
Use appropriate tool choice settings: "auto" for the model to decide, "none" to disable tools, or specific tool selection for controlled execution. Choose based on your use case requirements.

*استخدم إعدادات اختيار الأداة المناسبة: "auto" للنموذج ليقرر، "none" لتعطيل الأدوات، أو اختيار أداة محددة للتنفيذ المتحكم به. اختر بناءً على متطلبات حالة الاستخدام.*

### Security Considerations
Validate and sanitize all tool inputs to prevent injection attacks and unauthorized actions. Implement authentication and authorization for tools that perform sensitive operations. Limit tool capabilities to necessary functions.

*تحقق من جميع مدخلات الأداة وعقمها لمنع هجمات الحقن والإجراءات غير المصرح بها. نفذ المصادقة والتفويض للأدوات التي تنفذ عمليات حساسة. حدد قدرات الأداة للدوال الضرورية فقط.*

## When NOT to Use

### Don't Overuse Tools
Avoid creating tools for every possible action. Some tasks are better handled through natural language generation. Use tools only when external integration or action execution is necessary.

*تجنب إنشاء أدوات لكل إجراء محتمل. بعض المهام يتم التعامل معها بشكل أفضل من خلال توليد اللغة الطبيعية. استخدم الأدوات فقط عندما يكون التكامل الخارجي أو تنفيذ الإجراء ضرورياً.*

### Don't Create Overly Complex Tools
Avoid tools with too many parameters or complex logic. Keep tools simple and focused. Complex operations should be handled by external systems, not within tool definitions.

*تجنب الأدوات مع الكثير من المعاملات أو المنطق المعقد. حافظ على الأدوات بسيطة ومركزة. العمليات المعقدة يجب أن يتم التعامل معها من قبل الأنظمة الخارجية، وليس داخل تعريفات الأدوات.*

### Don't Skip Validation
Never skip parameter validation for tool calls. Invalid inputs can cause errors, security issues, or unexpected behavior. Always validate and sanitize inputs before execution.

*لا تتخطى التحقق من المعاملات لاستدعاءات الأدوات أبداً. المدخلات غير الصالحة يمكن أن تسبب أخطاء أو مشاكل أمنية أو سلوك غير متوقع. تحقق دائماً من المدخلات وعقمها قبل التنفيذ.*

### Don't Ignore Errors
Don't ignore tool call errors or failures. Implement proper error handling and user feedback. Silent failures can lead to poor user experience and difficult debugging.

*لا تتجاهل أخطاء أو فشل استدعاءات الأدوات. نفذ معالجة أخطاء مناسبة وردود فعل المستخدم. الفشل الصامت يمكن أن يؤدي إلى تجربة مستخدم ضعيفة وتشخيص صعب.*

## Troubleshooting

### Tool Not Being Called
If tools aren't being called, check tool definitions are correct and properly formatted. Verify tool_choice is set appropriately (not "none"). Ensure tool descriptions clearly indicate when to use the tool.

*إذا لم يتم استدعاء الأدوات، تحقق من أن تعريفات الأدوات صحيحة ومنسقة بشكل صحيح. تحقق من أن tool_choice مضبوط بشكل مناسب (ليس "none"). تأكد من أن أوصاف الأدوات تشير بوضوح إلى متى تستخدم الأداة.*

### Invalid Parameters
If tool calls fail due to invalid parameters, review parameter schemas and validation logic. Ensure parameter types match expected formats. Add better parameter descriptions to help the model provide correct values.

*إذا فشلت استدعاءات الأدوات بسبب معاملات غير صالحة، راجع مخططات المعاملات ومنطق التحقق. تأكد من أن أنواع المعاملات تطابق التنسيقات المتوقعة. أضف أوصاف معاملات أفضل لمساعدة النموذج على توفير قيم صحيحة.*

### Tool Execution Errors
If tool execution fails, check external service availability, network connectivity, and API authentication. Review error messages and implement proper error handling. Consider retry logic for transient failures.

*إذا فشل تنفيذ الأداة، تحقق من توفر الخدمة الخارجية واتصال الشبكة ومصادقة API. راجع رسائل الخطأ ونفذ معالجة أخطاء مناسبة. فكر في منطق إعادة المحاولة للفشل المؤقت.*

### High Token Costs
If token costs are high, review tool definitions for unnecessary verbosity. Limit tool result sizes. Consider caching tool results when appropriate. Optimize tool usage to minimize calls.

*إذا كانت تكاليف الرموز المميزة عالية، راجع تعريفات الأدوات للإسهاب غير الضروري. حدد أحجام نتائج الأداة. فكر في تخزين نتائج الأداة مؤقتاً عند الاقتضاء. قم بتحسين استخدام الأداة لتقليل الاستدعاءات.*

## Basic Usage

### Define Tools

*تعريف الأدوات*

```python
from app.models.tools import ToolDefinition, FunctionDefinition, FunctionParameter

tool = ToolDefinition(
    type="function",
    function=FunctionDefinition(
        name="get_weather",
        description="Get weather for a location",
        parameters=FunctionParameter(
            type="object",
            properties={
                "location": {"type": "string", "description": "City name"}
            },
            required=["location"]
        )
    )
)
```

### Use Tools

*استخدام الأدوات*

```python
from app.builders import ChatRequestBuilder

request = (ChatRequestBuilder()
    .with_model("anthropic/claude-sonnet-4")
    .with_text("What's the weather in Boston?")
    .with_tools([tool], tool_choice="auto")
    .build())
```

### Tool Choice Options

*خيارات اختيار الأداة*

- `"none"` - Don't call tools
  *`"none"` - لا تستدعي الأدوات*
- `"auto"` - Let model decide
  *`"auto"` - دع النموذج يقرر*
- `ToolChoiceConfig` - Specific function
  *`ToolChoiceConfig` - دالة محددة*

```python
from app.models.tools import ToolChoiceConfig, ToolChoiceFunction

tool_choice = ToolChoiceConfig(
    type="function",
    function=ToolChoiceFunction(name="get_weather")
)
```

### Process Tool Calls

*معالجة استدعاءات الأدوات*

```python
from app.processors import ToolCallProcessor

response = await client.chat_completion(request)
processor = ToolCallProcessor()
tool_calls = processor.process_tool_calls(response)
```

## Advanced Examples

### Multiple Tools

*أدوات متعددة*

```python
from app.models.tools import ToolDefinition, FunctionDefinition, FunctionParameter

weather_tool = ToolDefinition(
    type="function",
    function=FunctionDefinition(
        name="get_weather",
        description="Get current weather for a location",
        parameters=FunctionParameter(
            type="object",
            properties={
                "location": {"type": "string", "description": "City name"}
            },
            required=["location"]
        )
    )
)

calendar_tool = ToolDefinition(
    type="function",
    function=FunctionDefinition(
        name="create_event",
        description="Create a calendar event",
        parameters=FunctionParameter(
            type="object",
            properties={
                "title": {"type": "string"},
                "date": {"type": "string", "format": "date"},
                "time": {"type": "string"}
            },
            required=["title", "date", "time"]
        )
    )
)

request = (ChatRequestBuilder()
    .with_model("anthropic/claude-sonnet-4")
    .with_text("Check the weather in Paris and create a calendar event for tomorrow at 2pm")
    .with_tools([weather_tool, calendar_tool], tool_choice="auto")
    .build())
```

### Tool with Structured Response

*أداة مع استجابة منظمة*

```python
database_tool = ToolDefinition(
    type="function",
    function=FunctionDefinition(
        name="query_database",
        description="Query the customer database",
        parameters=FunctionParameter(
            type="object",
            properties={
                "query": {"type": "string", "description": "SQL-like query"},
                "table": {"type": "string", "description": "Table name"}
            },
            required=["query", "table"]
        )
    )
)

request = (ChatRequestBuilder()
    .with_model("anthropic/claude-sonnet-4")
    .with_text("Find all customers from New York")
    .with_tools([database_tool], tool_choice="auto")
    .build())
```

### Forced Tool Execution

*تنفيذ أداة إجباري*

```python
from app.models.tools import ToolChoiceConfig, ToolChoiceFunction

# Force specific tool execution
tool_choice = ToolChoiceConfig(
    type="function",
    function=ToolChoiceFunction(name="get_weather")
)

request = (ChatRequestBuilder()
    .with_model("anthropic/claude-sonnet-4")
    .with_text("What's the weather?")
    .with_tools([weather_tool], tool_choice=tool_choice)
    .build())
```
